<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Agile Toolkit: /Users/rw/Sites/atk4web/atk4/lib/DB/dsql.php Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Agile Toolkit
   &#160;<span id="projectnumber">4.2</span>
   </div>
   <div id="projectbrief">Agile Toolkit is a powerful web development framework. Inspired by GUI Applications development</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('dsql_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">/Users/rw/Sites/atk4web/atk4/lib/DB/dsql.php</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php <span class="comment">// vim:ts=4:sw=4:et:fdm=marker</span>
<a name="l00013"></a><a class="code" href="class_d_b__dsql.html">00013</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="class_d_b__dsql.html">DB_dsql</a> <span class="keyword">extends</span> <a class="code" href="class_abstract_model.html">AbstractModel</a> implements Iterator {
<a name="l00015"></a><a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">00015</a>     <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">$args</a>=array();
<a name="l00016"></a>00016 
<a name="l00018"></a><a class="code" href="class_d_b__dsql.html#afe68e6fbe7acfbffc0af0c84a1996466">00018</a>     <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#afe68e6fbe7acfbffc0af0c84a1996466">$params</a>=array();
<a name="l00019"></a>00019 
<a name="l00021"></a><a class="code" href="class_d_b__dsql.html#a5a9a2baddf56ecd282bd4444816a728f">00021</a>     <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#a5a9a2baddf56ecd282bd4444816a728f">$extra_params</a>=array();
<a name="l00022"></a>00022 
<a name="l00024"></a><a class="code" href="class_d_b__dsql.html#af27a9140d5f2658693e7fd107f716449">00024</a>     <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#af27a9140d5f2658693e7fd107f716449">$stmt</a>=null;
<a name="l00025"></a>00025 
<a name="l00027"></a><a class="code" href="class_d_b__dsql.html#aa3e9534005fd516d941f6a5569896e01">00027</a>     <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#aa3e9534005fd516d941f6a5569896e01">$template</a>=null;
<a name="l00028"></a>00028 
<a name="l00030"></a><a class="code" href="class_d_b__dsql.html#a3aaf40baac36e278c7d7c9139df1750c">00030</a>     <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>=null;
<a name="l00031"></a>00031 
<a name="l00033"></a><a class="code" href="class_d_b__dsql.html#a0f5965a14f82030869799a6391504245">00033</a>     <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#a0f5965a14f82030869799a6391504245">$main_table</a>=null;
<a name="l00034"></a>00034 
<a name="l00036"></a><a class="code" href="class_d_b__dsql.html#a0cbd93284d94e456702c9dc09539d96e">00036</a>     <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#a0cbd93284d94e456702c9dc09539d96e">$default_field</a>=<span class="charliteral">&#39;*&#39;</span>;
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="class_d_b__dsql.html#ade8f8bc9c31f13c39edfe43aaea3a4e8">00038</a>     <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#ade8f8bc9c31f13c39edfe43aaea3a4e8">$default_exception</a>=<span class="stringliteral">&#39;Exception_DB&#39;</span>;
<a name="l00039"></a>00039 
<a name="l00041"></a><a class="code" href="class_d_b__dsql.html#a85ae3e64cd40e9564adceb010085e9dd">00041</a>     <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#a85ae3e64cd40e9564adceb010085e9dd">$debug</a>=<span class="keyword">false</span>;
<a name="l00042"></a>00042 
<a name="l00044"></a><a class="code" href="class_d_b__dsql.html#a354ccb93d5a00b90fc28fec508b15332">00044</a>     <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#a354ccb93d5a00b90fc28fec508b15332">$param_base</a>=<span class="charliteral">&#39;a&#39;</span>;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     <span class="keyword">public</span> $sql_templates=array(
<a name="l00047"></a>00047         <span class="stringliteral">&#39;select&#39;</span>=&gt;<span class="stringliteral">&quot;select [options] [field] [from] [table] [join] [where] [group] [having] [order] [limit]&quot;</span>,
<a name="l00048"></a>00048         <span class="stringliteral">&#39;insert&#39;</span>=&gt;<span class="stringliteral">&quot;insert [options_insert] into [table_noalias] ([set_fields]) values ([set_values])&quot;</span>,
<a name="l00049"></a>00049         <span class="stringliteral">&#39;replace&#39;</span>=&gt;<span class="stringliteral">&quot;replace [options_replace] into [table_noalias] ([set_fields]) values ([set_value])&quot;</span>,
<a name="l00050"></a>00050         <span class="stringliteral">&#39;update&#39;</span>=&gt;<span class="stringliteral">&quot;update [table_noalias] set [set] [where]&quot;</span>,
<a name="l00051"></a>00051         <span class="stringliteral">&#39;delete&#39;</span>=&gt;<span class="stringliteral">&quot;delete from  [table_noalias] [where]&quot;</span>,
<a name="l00052"></a>00052         <span class="stringliteral">&#39;truncate&#39;</span>=&gt;<span class="stringliteral">&#39;truncate table [table_noalias]&#39;</span>
<a name="l00053"></a>00053     );
<a name="l00054"></a>00054 
<a name="l00055"></a>00055     <span class="comment">// {{{ Generic stuff</span>
<a name="l00056"></a><a class="code" href="class_d_b__dsql.html#a20c1a04194fec3717ca151e1165f6743">00056</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a20c1a04194fec3717ca151e1165f6743">_unique</a>(&amp;$array,$desired=null){
<a name="l00057"></a>00057         $desired=preg_replace(<span class="stringliteral">&#39;/[^a-zA-Z0-9:]/&#39;</span>,<span class="charliteral">&#39;_&#39;</span>,$desired);
<a name="l00058"></a>00058         $desired=<a class="code" href="class_d_b__dsql.html#a20c1a04194fec3717ca151e1165f6743">parent::_unique</a>($array,$desired);
<a name="l00059"></a>00059         <span class="keywordflow">return</span> $desired;
<a name="l00060"></a>00060     }
<a name="l00061"></a><a class="code" href="class_d_b__dsql.html#ad0cb87b388bc74d63dc884accdca8713">00061</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#ad0cb87b388bc74d63dc884accdca8713">__clone</a>(){
<a name="l00062"></a>00062         $this-&gt;stmt=null;
<a name="l00063"></a>00063     }
<a name="l00064"></a>00064     <span class="keyword">function</span> __toString(){
<a name="l00065"></a>00065         <span class="keywordflow">try</span> {
<a name="l00066"></a>00066             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#afde88292c44dc59faf017738dae6dffb">render</a>();
<a name="l00067"></a>00067         }<span class="keywordflow">catch</span>(Exception $e){
<a name="l00068"></a>00068             <span class="keywordflow">return</span> <span class="stringliteral">&quot;Exception: &quot;</span>.$e-&gt;getText();
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         <span class="keywordflow">return</span> $this-&gt;toString();
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a0fd03e124cf2e910eac90a201bdedd01">expr</a>)<span class="keywordflow">return</span> $this-&gt;parseTemplate($this-&gt;<a class="code" href="class_d_b__dsql.html#a0fd03e124cf2e910eac90a201bdedd01">expr</a>);
<a name="l00074"></a>00074         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a701f78ac6d7ece9e18883fe7ee612e9f">select</a>();
<a name="l00075"></a>00075     }
<a name="l00077"></a><a class="code" href="class_d_b__dsql.html#a2e98fa0bf8a8263c1f551bdb3a4b65d5">00077</a>     <span class="keyword">function</span> <span class="keyword">template</span>(<a class="code" href="class_d_b__dsql.html#aa3e9534005fd516d941f6a5569896e01">$template</a>){
<a name="l00078"></a>00078         $this-&gt;<span class="keyword">template</span>=<a class="code" href="class_d_b__dsql.html#aa3e9534005fd516d941f6a5569896e01">$template</a>;
<a name="l00079"></a>00079         <span class="keywordflow">return</span> $this;
<a name="l00080"></a>00080     }
<a name="l00082"></a><a class="code" href="class_d_b__dsql.html#ae7ab94489c6b0ee87cbe0f203ef27c8a">00082</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#ae7ab94489c6b0ee87cbe0f203ef27c8a">paramBase</a>(<a class="code" href="class_d_b__dsql.html#a354ccb93d5a00b90fc28fec508b15332">$param_base</a>){
<a name="l00083"></a>00083         $this-&gt;param_base=<a class="code" href="class_d_b__dsql.html#a354ccb93d5a00b90fc28fec508b15332">$param_base</a>;
<a name="l00084"></a>00084         <span class="keywordflow">return</span> $this;
<a name="l00085"></a>00085     }
<a name="l00087"></a><a class="code" href="class_d_b__dsql.html#ae0776fe52cb65d0a646d1ad9a4f5e668">00087</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#ae0776fe52cb65d0a646d1ad9a4f5e668">dsql</a>(){
<a name="l00088"></a>00088         <span class="keywordflow">return</span> $this-&gt;owner-&gt;dsql(get_class($this));
<a name="l00089"></a>00089     }
<a name="l00091"></a><a class="code" href="class_d_b__dsql.html#a779e0391b11124388a4f850714c3c837">00091</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a779e0391b11124388a4f850714c3c837">escape</a>($val){
<a name="l00092"></a>00092         <span class="keywordflow">if</span>($val===undefined)<span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00093"></a>00093         <span class="keywordflow">if</span>(is_array($val)){
<a name="l00094"></a>00094             $out=array();
<a name="l00095"></a>00095             <span class="keywordflow">foreach</span>($val as $v){
<a name="l00096"></a>00096                 $out[]=$this-&gt;<a class="code" href="class_d_b__dsql.html#a779e0391b11124388a4f850714c3c837">escape</a>($v);
<a name="l00097"></a>00097             }
<a name="l00098"></a>00098             <span class="keywordflow">return</span> $out;
<a name="l00099"></a>00099         }
<a name="l00100"></a>00100         <a class="code" href="class_abstract_object.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>=<span class="charliteral">&#39;:&#39;</span>.$this-&gt;param_base;
<a name="l00101"></a>00101         <a class="code" href="class_abstract_object.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>=$this-&gt;<a class="code" href="class_d_b__dsql.html#a20c1a04194fec3717ca151e1165f6743">_unique</a>($this-&gt;params,<a class="code" href="class_abstract_object.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>);
<a name="l00102"></a>00102         $this-&gt;params[<a class="code" href="class_abstract_object.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>]=$val;
<a name="l00103"></a>00103         <span class="keywordflow">return</span> <a class="code" href="class_abstract_object.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>;
<a name="l00104"></a>00104     }
<a name="l00106"></a><a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">00106</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($dsql,$tick=<span class="keyword">true</span>){
<a name="l00107"></a>00107         <span class="keywordflow">if</span>($dsql===undefined)<span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00108"></a>00108         <span class="keywordflow">if</span>($dsql===null)<span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00109"></a>00109         <span class="keywordflow">if</span>(is_object($dsql) &amp;&amp; $dsql instanceof <a class="code" href="class_field.html">Field</a>)<span class="keywordflow">return</span> $dsql-&gt;getExpr();
<a name="l00110"></a>00110         <span class="keywordflow">if</span>(!is_object($dsql) || !$dsql instanceof <a class="code" href="class_d_b__dsql.html">DB_dsql</a>)<span class="keywordflow">return</span> $tick?$this-&gt;bt($dsql):$dsql;
<a name="l00111"></a>00111         $dsql-&gt;params = &amp;$this-&gt;params;
<a name="l00112"></a>00112         $ret = $dsql-&gt;_render();
<a name="l00113"></a>00113         <span class="keywordflow">if</span>($dsql-&gt;mode==<span class="stringliteral">&#39;select&#39;</span>)$ret=<span class="charliteral">&#39;(&#39;</span>.$ret.<span class="charliteral">&#39;)&#39;</span>;
<a name="l00114"></a>00114         unset($dsql-&gt;params);$dsql-&gt;params=array();
<a name="l00115"></a>00115         <span class="keywordflow">return</span> $ret;
<a name="l00116"></a>00116     }
<a name="l00118"></a><a class="code" href="class_d_b__dsql.html#aa6bb3963a407a4d770a71279a5ffac59">00118</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#aa6bb3963a407a4d770a71279a5ffac59">setCustom</a>(<a class="code" href="class_d_b__dsql.html#aa3e9534005fd516d941f6a5569896e01">$template</a>,$value){
<a name="l00119"></a>00119         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;custom&#39;</span>][<a class="code" href="class_d_b__dsql.html#aa3e9534005fd516d941f6a5569896e01">$template</a>]=$value;
<a name="l00120"></a>00120         <span class="keywordflow">return</span> $this;
<a name="l00121"></a>00121     }
<a name="l00123"></a><a class="code" href="class_d_b__dsql.html#ad07e8760e1263533acbfe0eb8cb4e6a5">00123</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#ad07e8760e1263533acbfe0eb8cb4e6a5">del</a>(<a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">$args</a>){
<a name="l00124"></a>00124                 $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">$args</a>]=array();
<a name="l00125"></a>00125         <span class="keywordflow">return</span> $this;
<a name="l00126"></a>00126     }
<a name="l00128"></a><a class="code" href="class_d_b__dsql.html#a4a20559544fdf4dcb457e258dc976cf8">00128</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a4a20559544fdf4dcb457e258dc976cf8">reset</a>(){
<a name="l00129"></a>00129         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>=array();
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131     <span class="comment">// }}}</span>
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="comment">// {{{ Dynamic Query Definition methods</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <span class="comment">// {{{ Generic methods</span>
<a name="l00137"></a><a class="code" href="class_d_b__dsql.html#a0fd03e124cf2e910eac90a201bdedd01">00137</a> <span class="comment"></span>    <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a0fd03e124cf2e910eac90a201bdedd01">expr</a>($expr,<a class="code" href="class_d_b__dsql.html#afe68e6fbe7acfbffc0af0c84a1996466">$params</a>=array()){
<a name="l00138"></a>00138         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#ae0776fe52cb65d0a646d1ad9a4f5e668">dsql</a>()-&gt;useExpr($expr,<a class="code" href="class_d_b__dsql.html#afe68e6fbe7acfbffc0af0c84a1996466">$params</a>);
<a name="l00139"></a>00139     }
<a name="l00141"></a><a class="code" href="class_d_b__dsql.html#a01d185dab1dda265506a243dfc8f5333">00141</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a01d185dab1dda265506a243dfc8f5333">orExpr</a>(){
<a name="l00142"></a>00142         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a0fd03e124cf2e910eac90a201bdedd01">expr</a>(<span class="stringliteral">&#39;([orwhere])&#39;</span>);
<a name="l00143"></a>00143     }
<a name="l00145"></a>00145     <span class="keyword">function</span> useExpr($expr,<a class="code" href="class_d_b__dsql.html#afe68e6fbe7acfbffc0af0c84a1996466">$params</a>=array()){
<a name="l00146"></a>00146         $this-&gt;<span class="keyword">template</span>=$expr;
<a name="l00147"></a>00147         $this-&gt;extra_params=<a class="code" href="class_d_b__dsql.html#afe68e6fbe7acfbffc0af0c84a1996466">$params</a>;
<a name="l00148"></a>00148         <span class="keywordflow">return</span> $this;
<a name="l00149"></a>00149     }
<a name="l00151"></a><a class="code" href="class_d_b__dsql.html#a243b8706719cb889c4667547e0e1292d">00151</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a243b8706719cb889c4667547e0e1292d">getField</a>($fld){
<a name="l00152"></a>00152         <span class="keywordflow">if</span>($this-&gt;main_table===<span class="keyword">false</span>)<span class="keywordflow">throw</span> $this-&gt;exception(<span class="stringliteral">&#39;Cannot use getField() when multiple tables are queried&#39;</span>);
<a name="l00153"></a>00153         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a0fd03e124cf2e910eac90a201bdedd01">expr</a>(
<a name="l00154"></a>00154             $this-&gt;bt($this-&gt;main_table).
<a name="l00155"></a>00155             <span class="charliteral">&#39;.&#39;</span>.
<a name="l00156"></a>00156             $this-&gt;bt($fld)
<a name="l00157"></a>00157         );
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159     <span class="comment">// }}}</span>
<a name="l00160"></a>00160     <span class="comment">// {{{ table()</span>
<a name="l00184"></a><a class="code" href="class_d_b__dsql.html#ac5e5ec0cf9a1473cc7acba95d8a76b8c">00184</a> <span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#ac5e5ec0cf9a1473cc7acba95d8a76b8c">table</a>($table=undefined,$alias=undefined){
<a name="l00185"></a>00185         <span class="keywordflow">if</span>($table===undefined)<span class="keywordflow">return</span> $this-&gt;main_table;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <span class="keywordflow">if</span>(is_array($table)){
<a name="l00188"></a>00188             <span class="keywordflow">foreach</span>($table as $alias=&gt;$t){
<a name="l00189"></a>00189                 <span class="keywordflow">if</span>(is_numeric($alias))$alias=undefined;
<a name="l00190"></a>00190                 $this-&gt;<a class="code" href="class_d_b__dsql.html#ac5e5ec0cf9a1473cc7acba95d8a76b8c">table</a>($t,$alias);
<a name="l00191"></a>00191             }
<a name="l00192"></a>00192             <span class="keywordflow">return</span> $this;
<a name="l00193"></a>00193         }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195         <span class="comment">// main_table tracking allows us to </span>
<a name="l00196"></a>00196         <span class="keywordflow">if</span>($this-&gt;main_table===null)$this-&gt;main_table=$alias===undefined||!$alias?$table:$alias;
<a name="l00197"></a>00197         elseif($this-&gt;main_table)$this-&gt;main_table=<span class="keyword">false</span>;   <span class="comment">// query from multiple tables</span>
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;table&#39;</span>][]=array($table,$alias);
<a name="l00200"></a>00200         <span class="keywordflow">return</span> $this;
<a name="l00201"></a>00201     }
<a name="l00203"></a><a class="code" href="class_d_b__dsql.html#a9ac4a48ca416c6fe93aec254ff247647">00203</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a9ac4a48ca416c6fe93aec254ff247647">render_table</a>(){
<a name="l00204"></a>00204         $ret=array();
<a name="l00205"></a>00205         <span class="keywordflow">if</span>(!is_array($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;table&#39;</span>]))<span class="keywordflow">return</span>;
<a name="l00206"></a>00206         <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;table&#39;</span>] as $row){
<a name="l00207"></a>00207             list($table,$alias)=$row;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209             $table=$this-&gt;bt($table);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211 
<a name="l00212"></a>00212             <span class="keywordflow">if</span>($alias!==undefined &amp;&amp; $alias)$table.=<span class="charliteral">&#39; &#39;</span>.$this-&gt;bt($alias);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214             $ret[]=$table;
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216         <span class="keywordflow">return</span> <a class="code" href="class_d_b__dsql.html#a0b2af216ca7dad64faa8d9ec06e69a06">join</a>(<span class="charliteral">&#39;,&#39;</span>,$ret);
<a name="l00217"></a>00217     }
<a name="l00219"></a><a class="code" href="class_d_b__dsql.html#a6415cd2096dd5ccdb7dcf4b0c8adf498">00219</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a6415cd2096dd5ccdb7dcf4b0c8adf498">render_from</a>(){
<a name="l00220"></a>00220         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;table&#39;</span>])<span class="keywordflow">return</span> <span class="stringliteral">&#39;from&#39;</span>;
<a name="l00221"></a>00221         <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00222"></a>00222     }
<a name="l00224"></a><a class="code" href="class_d_b__dsql.html#aaeefb62200b112381e6c42e8075517b6">00224</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#aaeefb62200b112381e6c42e8075517b6">render_table_noalias</a>(){
<a name="l00225"></a>00225         $ret=array();
<a name="l00226"></a>00226         <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;table&#39;</span>] as $row){
<a name="l00227"></a>00227             list($table,$alias)=$row;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229             $table=$this-&gt;bt($table);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 
<a name="l00232"></a>00232             $ret[]=$table;
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234         <span class="keywordflow">return</span> <a class="code" href="class_d_b__dsql.html#a0b2af216ca7dad64faa8d9ec06e69a06">join</a>(<span class="stringliteral">&#39;, &#39;</span>,$ret);
<a name="l00235"></a>00235         }
<a name="l00236"></a>00236     <span class="comment">// }}}</span>
<a name="l00237"></a>00237     <span class="comment">// {{{ field()</span>
<a name="l00266"></a><a class="code" href="class_d_b__dsql.html#a875ebca628ed88fff6c5f882210f1ab8">00266</a> <span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a875ebca628ed88fff6c5f882210f1ab8">field</a>($field,$table=null,$alias=null) {
<a name="l00267"></a>00267         <span class="keywordflow">if</span>(is_array($field)){
<a name="l00268"></a>00268             <span class="keywordflow">foreach</span>($field as $alias=&gt;$f){
<a name="l00269"></a>00269                 <span class="keywordflow">if</span>(is_numeric($alias))$alias=null;
<a name="l00270"></a>00270                 $this-&gt;<a class="code" href="class_d_b__dsql.html#a875ebca628ed88fff6c5f882210f1ab8">field</a>($f,$table,$alias);
<a name="l00271"></a>00271             }
<a name="l00272"></a>00272             <span class="keywordflow">return</span> $this;
<a name="l00273"></a>00273         }elseif(is_string($field)){
<a name="l00274"></a>00274             $field=explode(<span class="charliteral">&#39;,&#39;</span>,$field);
<a name="l00275"></a>00275             <span class="keywordflow">if</span>(count($field)&gt;1){
<a name="l00276"></a>00276                 <span class="keywordflow">foreach</span>($field as $f){
<a name="l00277"></a>00277                     $this-&gt;<a class="code" href="class_d_b__dsql.html#a875ebca628ed88fff6c5f882210f1ab8">field</a>($f,$table,$alias);
<a name="l00278"></a>00278                 }
<a name="l00279"></a>00279                 <span class="keywordflow">return</span> $this;
<a name="l00280"></a>00280             }
<a name="l00281"></a>00281             $field=$field[0];
<a name="l00282"></a>00282         }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="keywordflow">if</span>(is_object($field)){
<a name="l00285"></a>00285             <span class="comment">//if(!$table)throw $this-&gt;exception(&#39;Specified expression without alias&#39;)</span>
<a name="l00286"></a>00286             <span class="comment">//    -&gt;addMoreInfo(&#39;expr&#39;,$field);</span>
<a name="l00287"></a>00287             $alias=$table;$table=null;
<a name="l00288"></a>00288         }
<a name="l00289"></a>00289         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;fields&#39;</span>][]=array($field,$table,$alias);
<a name="l00290"></a>00290                 <span class="keywordflow">return</span> $this;
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292     <span class="keyword">function</span> render_field(){
<a name="l00293"></a>00293         $result=array();
<a name="l00294"></a>00294         <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;fields&#39;</span>]){
<a name="l00295"></a>00295             <span class="comment">//if($this-&gt;main_table)return &#39;*.&#39;.$this-&gt;main_table;</span>
<a name="l00296"></a>00296             <span class="keywordflow">return</span> (<span class="keywordtype">string</span>)$this-&gt;default_field;
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298         <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;fields&#39;</span>] as $row){
<a name="l00299"></a>00299             list($field,$table,$alias)=$row;
<a name="l00300"></a>00300             <span class="keywordflow">if</span>($alias==$field)$alias=undefined;
<a name="l00301"></a>00301             $this-&gt;api-&gt;pr-&gt;start(<span class="stringliteral">&#39;dsql/render/field/consume&#39;</span>);
<a name="l00302"></a>00302             $field=$this-&gt;<a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($field);
<a name="l00303"></a>00303             $this-&gt;api-&gt;pr-&gt;stop();
<a name="l00304"></a>00304             <span class="keywordflow">if</span>(!$field){
<a name="l00305"></a>00305                 $field=$table;
<a name="l00306"></a>00306                 $table=undefined;
<a name="l00307"></a>00307             }
<a name="l00308"></a>00308             <span class="keywordflow">if</span>($table &amp;&amp; $table!==undefined)$field=$this-&gt;bt($table).<span class="charliteral">&#39;.&#39;</span>.$field;
<a name="l00309"></a>00309             <span class="keywordflow">if</span>($alias &amp;&amp; $alias!==undefined)$field.=<span class="charliteral">&#39; &#39;</span>.$this-&gt;bt($alias);
<a name="l00310"></a>00310             $result[]=$field;
<a name="l00311"></a>00311         }
<a name="l00312"></a>00312         <span class="keywordflow">return</span> <a class="code" href="class_d_b__dsql.html#a0b2af216ca7dad64faa8d9ec06e69a06">join</a>(<span class="charliteral">&#39;,&#39;</span>,$result);
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314     <span class="comment">// }}}</span>
<a name="l00315"></a>00315     <span class="comment">// {{{ where() and having()</span>
<a name="l00342"></a><a class="code" href="class_d_b__dsql.html#a1a8293665bc3bc92d2bffcce1fb61bef">00342</a> <span class="comment"></span>    <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a1a8293665bc3bc92d2bffcce1fb61bef">where</a>($field,$cond=undefined,$value=undefined,$kind=<span class="stringliteral">&#39;where&#39;</span>){
<a name="l00343"></a>00343         <span class="keywordflow">if</span>(is_array($field)){
<a name="l00344"></a>00344             <span class="comment">// or conditions</span>
<a name="l00345"></a>00345             $or=$this-&gt;<a class="code" href="class_d_b__dsql.html#a01d185dab1dda265506a243dfc8f5333">orExpr</a>();
<a name="l00346"></a>00346             <span class="keywordflow">foreach</span>($field as $row){
<a name="l00347"></a>00347                 <span class="keywordflow">if</span>(is_array($row)){
<a name="l00348"></a>00348                     $or-&gt;where($row[0],
<a name="l00349"></a>00349                         isset($row[1])?$row[1]:undefined,
<a name="l00350"></a>00350                         isset($row[2])?$row[2]:undefined);
<a name="l00351"></a>00351                 }elseif(is_object($row)){
<a name="l00352"></a>00352                     $or-&gt;where($row);
<a name="l00353"></a>00353                 }<span class="keywordflow">else</span>{
<a name="l00354"></a>00354                     $or-&gt;where($or-&gt;expr($row));
<a name="l00355"></a>00355                 }
<a name="l00356"></a>00356             }
<a name="l00357"></a>00357             $field=$or;
<a name="l00358"></a>00358             $this-&gt;api-&gt;x=1;
<a name="l00359"></a>00359         }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 
<a name="l00362"></a>00362         <span class="keywordflow">if</span>(is_string($field) &amp;&amp; !preg_match(<span class="stringliteral">&#39;/^[.a-zA-Z0-9_]*$/&#39;</span>,$field)){
<a name="l00363"></a>00363             <span class="comment">// field contains non-alphanumeric values. Look for condition</span>
<a name="l00364"></a>00364             preg_match(<span class="stringliteral">&#39;/^([^ &lt;&gt;!=]*)([&gt;&lt;!=]*|( *(not|is|in|like))*) *$/&#39;</span>,$field,$matches);
<a name="l00365"></a>00365             $value=$cond;
<a name="l00366"></a>00366             $cond=$matches[2];
<a name="l00367"></a>00367             <span class="keywordflow">if</span>(!$cond){
<a name="l00368"></a>00368 
<a name="l00369"></a>00369                 <span class="comment">// IF COMPAT</span>
<a name="l00370"></a>00370                 $matches[1]=$this-&gt;<a class="code" href="class_d_b__dsql.html#a0fd03e124cf2e910eac90a201bdedd01">expr</a>($field);
<a name="l00371"></a>00371                 <span class="keywordflow">if</span>($value &amp;&amp; $value!==undefined)$cond=<span class="charliteral">&#39;=&#39;</span>;<span class="keywordflow">else</span> $cond=undefined;
<a name="l00372"></a>00372                 <span class="comment">//throw $this-&gt;exception(&#39;Field is specified incorrectly or condition is not supported&#39;)</span>
<a name="l00373"></a>00373                     <span class="comment">//-&gt;addMoreInfo(&#39;field&#39;,$field);</span>
<a name="l00374"></a>00374             }
<a name="l00375"></a>00375             $field=$matches[1];
<a name="l00376"></a>00376         }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378         <span class="comment">//if($value==undefined &amp;&amp; !is_object($field) &amp;&amp; !is_object($cond))throw $this-&gt;exception(&#39;value is not specified&#39;);</span>
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[$kind][]=array($field,$cond,$value);
<a name="l00381"></a>00381         <span class="keywordflow">return</span> $this;
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383     <span class="keyword">function</span> having($field,$cond=undefined,$value=undefined){
<a name="l00384"></a>00384         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a1a8293665bc3bc92d2bffcce1fb61bef">where</a>($field,$cond,$value,<span class="stringliteral">&#39;having&#39;</span>);
<a name="l00385"></a>00385     }
<a name="l00386"></a>00386     <span class="keyword">function</span> _render_where($kind){
<a name="l00387"></a>00387         $ret=array();
<a name="l00388"></a>00388         <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[$kind] as $row){
<a name="l00389"></a>00389             list($field,$cond,$value)=$row;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391             <span class="keywordflow">if</span>(is_object($field)){
<a name="l00392"></a>00392                 <span class="comment">// if first argument is object, condition must be explicitly specified</span>
<a name="l00393"></a>00393                 $field=$this-&gt;<a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($field);
<a name="l00394"></a>00394             }<span class="keywordflow">else</span>{
<a name="l00395"></a>00395                 list($table,$field)=explode(<span class="charliteral">&#39;.&#39;</span>,$field,2);
<a name="l00396"></a>00396                 <span class="keywordflow">if</span>($field){
<a name="l00397"></a>00397                     $field=$this-&gt;bt($table).<span class="charliteral">&#39;.&#39;</span>.$this-&gt;bt($field);
<a name="l00398"></a>00398                 }<span class="keywordflow">else</span>{
<a name="l00399"></a>00399                     $field=$this-&gt;bt($table);
<a name="l00400"></a>00400                 }
<a name="l00401"></a>00401             }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403             <span class="keywordflow">if</span>($value===undefined &amp;&amp; $cond===undefined){
<a name="l00404"></a>00404                 $r=$field;
<a name="l00405"></a>00405                 $ret[]=$r;
<a name="l00406"></a>00406                 <span class="keywordflow">continue</span>;
<a name="l00407"></a>00407             }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409             <span class="keywordflow">if</span>($value===undefined){
<a name="l00410"></a>00410                 $value=$cond;
<a name="l00411"></a>00411                 $cond=<span class="charliteral">&#39;=&#39;</span>;
<a name="l00412"></a>00412                 <span class="keywordflow">if</span>(is_array($value))$cond=<span class="stringliteral">&#39;in&#39;</span>;
<a name="l00413"></a>00413                 <span class="keywordflow">if</span>(is_object($value) &amp;&amp; @$value-&gt;mode==<span class="stringliteral">&#39;select&#39;</span>)$cond=<span class="stringliteral">&#39;in&#39;</span>;
<a name="l00414"></a>00414             }<span class="keywordflow">else</span>{
<a name="l00415"></a>00415                 $cond=trim($cond);
<a name="l00416"></a>00416             }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418 
<a name="l00419"></a>00419             <span class="keywordflow">if</span>($cond==<span class="stringliteral">&#39;in&#39;</span> &amp;&amp; is_string($value)){
<a name="l00420"></a>00420                 $value=explode(<span class="charliteral">&#39;,&#39;</span>,$value);
<a name="l00421"></a>00421             }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423             <span class="keywordflow">if</span>(is_array($value)){
<a name="l00424"></a>00424                 $v=array();
<a name="l00425"></a>00425                 <span class="keywordflow">foreach</span>($value as $vv){
<a name="l00426"></a>00426                     $v[]=$this-&gt;<a class="code" href="class_d_b__dsql.html#a779e0391b11124388a4f850714c3c837">escape</a>($vv);
<a name="l00427"></a>00427                 }
<a name="l00428"></a>00428                 $value=<span class="charliteral">&#39;(&#39;</span>.join(<span class="charliteral">&#39;,&#39;</span>,$v).<span class="charliteral">&#39;)&#39;</span>;
<a name="l00429"></a>00429                 $cond=<span class="stringliteral">&#39;in&#39;</span>;
<a name="l00430"></a>00430                 $r=$this-&gt;<a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($field).<span class="charliteral">&#39; &#39;</span>.$cond.<span class="charliteral">&#39; &#39;</span>.$value;
<a name="l00431"></a>00431                 $ret[]=$r;
<a name="l00432"></a>00432                 <span class="keywordflow">continue</span>;
<a name="l00433"></a>00433             }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435             <span class="keywordflow">if</span>(is_object($value))$value=$this-&gt;<a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($value);<span class="keywordflow">else</span>$value=$this-&gt;<a class="code" href="class_d_b__dsql.html#a779e0391b11124388a4f850714c3c837">escape</a>($value);
<a name="l00436"></a>00436 
<a name="l00437"></a>00437             $r=$field.<span class="charliteral">&#39; &#39;</span>.$cond.<span class="charliteral">&#39; &#39;</span>.$value;
<a name="l00438"></a>00438             $ret[]=$r;
<a name="l00439"></a>00439         }
<a name="l00440"></a>00440         <span class="keywordflow">return</span> $ret;
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442     <span class="keyword">function</span> render_where(){
<a name="l00443"></a>00443         <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;where&#39;</span>])<span class="keywordflow">return</span>;
<a name="l00444"></a>00444         <span class="keywordflow">return</span> <span class="stringliteral">&#39;where &#39;</span>.join(<span class="stringliteral">&#39; and &#39;</span>,$this-&gt;_render_where(<span class="stringliteral">&#39;where&#39;</span>));
<a name="l00445"></a>00445     }
<a name="l00446"></a>00446     <span class="keyword">function</span> render_orwhere(){
<a name="l00447"></a>00447         <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;where&#39;</span>])<span class="keywordflow">return</span>;
<a name="l00448"></a>00448         <span class="keywordflow">return</span> <a class="code" href="class_d_b__dsql.html#a0b2af216ca7dad64faa8d9ec06e69a06">join</a>(<span class="stringliteral">&#39; or &#39;</span>,$this-&gt;_render_where(<span class="stringliteral">&#39;where&#39;</span>));
<a name="l00449"></a>00449     }
<a name="l00450"></a>00450     <span class="keyword">function</span> render_having(){
<a name="l00451"></a>00451         <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;having&#39;</span>])<span class="keywordflow">return</span>;
<a name="l00452"></a>00452         <span class="keywordflow">return</span> <span class="stringliteral">&#39;having &#39;</span>.join(<span class="stringliteral">&#39; and &#39;</span>,$this-&gt;_render_where(<span class="stringliteral">&#39;having&#39;</span>));
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454     <span class="comment">// }}}</span>
<a name="l00455"></a>00455     <span class="comment">// {{{ join()</span>
<a name="l00476"></a><a class="code" href="class_d_b__dsql.html#a0b2af216ca7dad64faa8d9ec06e69a06">00476</a> <span class="comment"></span>        <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a0b2af216ca7dad64faa8d9ec06e69a06">join</a>($foreign_table, $master_field=null, $join_kind=null, $_foreign_alias=null){
<a name="l00477"></a>00477         <span class="comment">// Compatibility mode</span>
<a name="l00478"></a>00478         <span class="keywordflow">if</span>(isset($this-&gt;api-&gt;compat)){
<a name="l00479"></a>00479             <span class="keywordflow">if</span>(strpos($foreign_table,<span class="charliteral">&#39; &#39;</span>)){
<a name="l00480"></a>00480                 list($foreign_table,$alias)=explode(<span class="charliteral">&#39; &#39;</span>,$foreign_table);
<a name="l00481"></a>00481                 $foreign_table=array($alias=&gt;$foreign_table);
<a name="l00482"></a>00482             }
<a name="l00483"></a>00483             <span class="keywordflow">if</span>(strpos($master_field,<span class="charliteral">&#39;=&#39;</span>)){
<a name="l00484"></a>00484                 $master_field=$this-&gt;<a class="code" href="class_d_b__dsql.html#a0fd03e124cf2e910eac90a201bdedd01">expr</a>($master_field);
<a name="l00485"></a>00485             }
<a name="l00486"></a>00486         }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         <span class="comment">// If array - add recursively</span>
<a name="l00489"></a>00489         <span class="keywordflow">if</span>(is_array($foreign_table)){
<a name="l00490"></a>00490             <span class="keywordflow">foreach</span> ($foreign_table as $alias=&gt;$foreign){
<a name="l00491"></a>00491                 <span class="keywordflow">if</span>(is_numeric($alias))$alias=null;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493                 $this-&gt;<a class="code" href="class_d_b__dsql.html#a0b2af216ca7dad64faa8d9ec06e69a06">join</a>($foreign,$master_field,$join_kind,$alias);
<a name="l00494"></a>00494             }
<a name="l00495"></a>00495             <span class="keywordflow">return</span> $this;
<a name="l00496"></a>00496         }
<a name="l00497"></a>00497         $j=array();
<a name="l00498"></a>00498 
<a name="l00499"></a>00499         <span class="comment">// Split and deduce fields</span>
<a name="l00500"></a>00500         list($f1,$f2)=explode(<span class="charliteral">&#39;.&#39;</span>,$foreign_table,2);
<a name="l00501"></a>00501 
<a name="l00502"></a>00502         <span class="keywordflow">if</span>(is_object($master_field)){
<a name="l00503"></a>00503             $j[<span class="stringliteral">&#39;expr&#39;</span>]=$master_field;
<a name="l00504"></a>00504         }<span class="keywordflow">else</span>{
<a name="l00505"></a>00505             <span class="comment">// Split and deduce primary table</span>
<a name="l00506"></a>00506             <span class="keywordflow">if</span>(is_null($master_field)){
<a name="l00507"></a>00507                 list($m1,$m2)=array(null,null);
<a name="l00508"></a>00508             }<span class="keywordflow">else</span>{
<a name="l00509"></a>00509                 list($m1,$m2)=explode(<span class="charliteral">&#39;.&#39;</span>,$master_field,2);
<a name="l00510"></a>00510             }
<a name="l00511"></a>00511             <span class="keywordflow">if</span>(is_null($m2)){
<a name="l00512"></a>00512                 $m2=$m1; $m1=null;
<a name="l00513"></a>00513             }
<a name="l00514"></a>00514             <span class="keywordflow">if</span>(is_null($m1))$m1=$this-&gt;main_table;
<a name="l00515"></a>00515 
<a name="l00516"></a>00516             <span class="comment">// Identify fields we use for joins</span>
<a name="l00517"></a>00517             <span class="keywordflow">if</span>(is_null($f2) &amp;&amp; is_null($m2))$m2=$f1.<span class="stringliteral">&#39;_id&#39;</span>;
<a name="l00518"></a>00518             <span class="keywordflow">if</span>(is_null($m2))$m2=<span class="stringliteral">&#39;id&#39;</span>;
<a name="l00519"></a>00519             $j[<span class="stringliteral">&#39;m1&#39;</span>]=$m1;
<a name="l00520"></a>00520             $j[<span class="stringliteral">&#39;m2&#39;</span>]=$m2;
<a name="l00521"></a>00521         }
<a name="l00522"></a>00522         $j[<span class="stringliteral">&#39;f1&#39;</span>]=$f1;
<a name="l00523"></a>00523         <span class="keywordflow">if</span>(is_null($f2))$f2=<span class="stringliteral">&#39;id&#39;</span>;
<a name="l00524"></a>00524         $j[<span class="stringliteral">&#39;f2&#39;</span>]=$f2;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526         $j[<span class="charliteral">&#39;t&#39;</span>]=$join_kind?:<span class="stringliteral">&#39;left&#39;</span>;
<a name="l00527"></a>00527         $j[<span class="stringliteral">&#39;fa&#39;</span>]=$_foreign_alias;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;join&#39;</span>][]=$j;
<a name="l00530"></a>00530         <span class="keywordflow">return</span> $this;
<a name="l00531"></a>00531     }
<a name="l00532"></a>00532     <span class="keyword">function</span> render_join(){
<a name="l00533"></a>00533         <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;join&#39;</span>])<span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00534"></a>00534         $joins=array();
<a name="l00535"></a>00535         <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;join&#39;</span>] as $j){
<a name="l00536"></a>00536             $jj=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538             $jj.=$j[<span class="charliteral">&#39;t&#39;</span>].<span class="stringliteral">&#39; join &#39;</span>;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540             $jj.=$this-&gt;bt($j[<span class="stringliteral">&#39;f1&#39;</span>]);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542             <span class="keywordflow">if</span>(!is_null($j[<span class="stringliteral">&#39;fa&#39;</span>]))$jj.=<span class="stringliteral">&#39; as &#39;</span>.$this-&gt;bt($j[<span class="stringliteral">&#39;fa&#39;</span>]);
<a name="l00543"></a>00543 
<a name="l00544"></a>00544             $jj.=<span class="stringliteral">&#39; on &#39;</span>;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546             <span class="keywordflow">if</span>($j[<span class="stringliteral">&#39;expr&#39;</span>]){
<a name="l00547"></a>00547                 $jj.=$this-&gt;<a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($j[<span class="stringliteral">&#39;expr&#39;</span>]);
<a name="l00548"></a>00548             }<span class="keywordflow">else</span>{
<a name="l00549"></a>00549                 $jj.=
<a name="l00550"></a>00550                     $this-&gt;bt($j[<span class="stringliteral">&#39;fa&#39;</span>]?:$j[<span class="stringliteral">&#39;f1&#39;</span>]).<span class="charliteral">&#39;.&#39;</span>.
<a name="l00551"></a>00551                     $this-&gt;bt($j[<span class="stringliteral">&#39;f2&#39;</span>]).<span class="stringliteral">&#39; = &#39;</span>.
<a name="l00552"></a>00552                     $this-&gt;bt($j[<span class="stringliteral">&#39;m1&#39;</span>]).<span class="charliteral">&#39;.&#39;</span>.
<a name="l00553"></a>00553                     $this-&gt;bt($j[<span class="stringliteral">&#39;m2&#39;</span>]);
<a name="l00554"></a>00554             }
<a name="l00555"></a>00555             $joins[]=$jj;
<a name="l00556"></a>00556         }
<a name="l00557"></a>00557         <span class="keywordflow">return</span> implode(<span class="charliteral">&#39; &#39;</span>,$joins);
<a name="l00558"></a>00558     }
<a name="l00559"></a>00559     <span class="comment">// }}}</span>
<a name="l00560"></a>00560     <span class="comment">// {{{ group()</span>
<a name="l00561"></a>00561     <span class="keyword">function</span> group($option){
<a name="l00562"></a>00562         <span class="keywordflow">return</span> $this-&gt;_setArray($option,<span class="stringliteral">&#39;group&#39;</span>);
<a name="l00563"></a>00563     }
<a name="l00564"></a>00564     <span class="keyword">function</span> render_group(){
<a name="l00565"></a>00565         <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;group&#39;</span>])<span class="keywordflow">return</span><span class="stringliteral">&#39;&#39;</span>;
<a name="l00566"></a>00566         $x=array();
<a name="l00567"></a>00567         <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;group&#39;</span>] as $arg){
<a name="l00568"></a>00568             $x[]=$this-&gt;bt($arg);
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570         <span class="keywordflow">return</span> <span class="stringliteral">&#39;group by &#39;</span>.implode(<span class="stringliteral">&#39;, &#39;</span>,$x);
<a name="l00571"></a>00571     }
<a name="l00572"></a>00572     <span class="comment">// }}}</span>
<a name="l00573"></a>00573     <span class="comment">// {{{ order()</span>
<a name="l00574"></a>00574     <span class="keyword">function</span> order($order,$desc=null){<span class="comment">// ,$prepend=null){</span>
<a name="l00575"></a>00575         <span class="keywordflow">if</span>(is_object($order))$order=<span class="charliteral">&#39;(&#39;</span>.$order.<span class="charliteral">&#39;)&#39;</span>;
<a name="l00576"></a>00576         <span class="keywordflow">if</span>($desc)$order.=<span class="stringliteral">&#39; desc&#39;</span>;
<a name="l00577"></a>00577         <span class="keywordflow">return</span> $this-&gt;_setArray($order,<span class="stringliteral">&#39;order&#39;</span>);
<a name="l00578"></a>00578     }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580     <span class="keyword">function</span> render_order(){
<a name="l00581"></a>00581         <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;order&#39;</span>])<span class="keywordflow">return</span><span class="stringliteral">&#39;&#39;</span>;
<a name="l00582"></a>00582         $x=array();
<a name="l00583"></a>00583         <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;order&#39;</span>] as $arg){
<a name="l00584"></a>00584             <span class="keywordflow">if</span>(substr($arg,-5)==<span class="stringliteral">&#39; desc&#39;</span>){
<a name="l00585"></a>00585                 $x[]=$this-&gt;bt(substr($arg,0,-5)).<span class="stringliteral">&#39; desc&#39;</span>;
<a name="l00586"></a>00586             }<span class="keywordflow">else</span>{
<a name="l00587"></a>00587                 $x[]=$this-&gt;bt($arg);
<a name="l00588"></a>00588             }
<a name="l00589"></a>00589         }
<a name="l00590"></a>00590         <span class="keywordflow">return</span> <span class="stringliteral">&#39;order by &#39;</span>.implode(<span class="stringliteral">&#39;, &#39;</span>,$x);
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     <span class="comment">// }}}</span>
<a name="l00594"></a>00594     <span class="comment">// {{{ option() and args()</span>
<a name="l00596"></a><a class="code" href="class_d_b__dsql.html#a654bdae7f73e012de801d33c542a7ae3">00596</a> <span class="comment"></span>    <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a654bdae7f73e012de801d33c542a7ae3">option</a>($option){
<a name="l00597"></a>00597         <span class="keywordflow">return</span> $this-&gt;_setArray($option,<span class="stringliteral">&#39;options&#39;</span>);
<a name="l00598"></a>00598     }
<a name="l00599"></a>00599     <span class="keyword">function</span> render_options(){
<a name="l00600"></a>00600         <span class="keywordflow">return</span> @implode(<span class="charliteral">&#39; &#39;</span>,$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;options&#39;</span>]);
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602     <span class="keyword">function</span> option_insert($option){
<a name="l00603"></a>00603         <span class="keywordflow">return</span> $this-&gt;_setArray($option,<span class="stringliteral">&#39;options_insert&#39;</span>);
<a name="l00604"></a>00604     }
<a name="l00605"></a>00605     <span class="keyword">function</span> render_options_insert(){
<a name="l00606"></a>00606         <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;options_insert&#39;</span>])<span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00607"></a>00607         <span class="keywordflow">return</span> implode(<span class="charliteral">&#39; &#39;</span>,$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;options_insert&#39;</span>]);
<a name="l00608"></a>00608     }
<a name="l00609"></a>00609     <span class="comment">// }}}</span>
<a name="l00610"></a>00610     <span class="comment">// {{{  args()</span>
<a name="l00612"></a><a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">00612</a> <span class="comment"></span>    <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>(<a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">$args</a>){
<a name="l00613"></a>00613         <span class="keywordflow">return</span> $this-&gt;_setArray(<a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">$args</a>,<span class="stringliteral">&#39;args&#39;</span>,<span class="keyword">false</span>);
<a name="l00614"></a>00614     }
<a name="l00615"></a>00615     <span class="keyword">function</span> render_args(){
<a name="l00616"></a>00616         $x=array();
<a name="l00617"></a>00617         <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;args&#39;</span>] as $arg){
<a name="l00618"></a>00618             $x[]=is_object($arg)?
<a name="l00619"></a>00619                 $this-&gt;<a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($arg):
<a name="l00620"></a>00620                 $this-&gt;<a class="code" href="class_d_b__dsql.html#a779e0391b11124388a4f850714c3c837">escape</a>($arg);
<a name="l00621"></a>00621         }
<a name="l00622"></a>00622         <span class="keywordflow">return</span> implode(<span class="stringliteral">&#39;, &#39;</span>,$x);
<a name="l00623"></a>00623     }
<a name="l00624"></a>00624     <span class="keyword">function</span> ignore(){
<a name="l00625"></a>00625         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;options_insert&#39;</span>][]=<span class="stringliteral">&#39;ignore&#39;</span>;
<a name="l00626"></a>00626         <span class="keywordflow">return</span> $this;
<a name="l00627"></a>00627     }
<a name="l00629"></a><a class="code" href="class_d_b__dsql.html#a11ad07d9420b0b9db29da1e39a596e98">00629</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a11ad07d9420b0b9db29da1e39a596e98">hasOption</a>($option){
<a name="l00630"></a>00630         <span class="keywordflow">return</span> @in_array($option,$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;options&#39;</span>]);
<a name="l00631"></a>00631     }
<a name="l00632"></a>00632     <span class="keyword">function</span> hasInsertOption($option){
<a name="l00633"></a>00633         <span class="keywordflow">return</span> @in_array($option,$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;options_insert&#39;</span>]);
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635     <span class="comment">// }}}</span>
<a name="l00636"></a>00636     <span class="comment">// {{{ limit()</span>
<a name="l00638"></a><a class="code" href="class_d_b__dsql.html#a2f26ab9edd3371c941d0c22205d40f33">00638</a> <span class="comment"></span>    <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a2f26ab9edd3371c941d0c22205d40f33">limit</a>($cnt,$shift=0){
<a name="l00639"></a>00639         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;limit&#39;</span>]=array(
<a name="l00640"></a>00640             <span class="stringliteral">&#39;cnt&#39;</span>=&gt;$cnt,
<a name="l00641"></a>00641             <span class="stringliteral">&#39;shift&#39;</span>=&gt;$shift
<a name="l00642"></a>00642         );
<a name="l00643"></a>00643         <span class="keywordflow">return</span> $this;
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645     <span class="keyword">function</span> render_limit(){
<a name="l00646"></a>00646         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;limit&#39;</span>]){
<a name="l00647"></a>00647             <span class="keywordflow">return</span> <span class="stringliteral">&#39;limit &#39;</span>.
<a name="l00648"></a>00648                 (int)$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;limit&#39;</span>][<span class="stringliteral">&#39;shift&#39;</span>].
<a name="l00649"></a>00649                 <span class="stringliteral">&#39;, &#39;</span>.
<a name="l00650"></a>00650                 (<span class="keywordtype">int</span>)$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;limit&#39;</span>][<span class="stringliteral">&#39;cnt&#39;</span>];
<a name="l00651"></a>00651         }
<a name="l00652"></a>00652     }
<a name="l00653"></a>00653     <span class="comment">// }}}</span>
<a name="l00654"></a>00654     <span class="comment">// {{{ set()</span>
<a name="l00655"></a>00655     <span class="keyword">function</span> <span class="keyword">set</span>($field,$value=undefined){
<a name="l00656"></a>00656         <span class="keywordflow">if</span>($value===<span class="keyword">false</span>){
<a name="l00657"></a>00657             <span class="keywordflow">throw</span> $this-&gt;exception(<span class="stringliteral">&#39;Value &quot;false&quot; is not supported by SQL&#39;</span>);
<a name="l00658"></a>00658         }
<a name="l00659"></a>00659         <span class="keywordflow">if</span>(is_array($field)){
<a name="l00660"></a>00660             <span class="keywordflow">foreach</span>($field as $key=&gt;$value){
<a name="l00661"></a>00661                 $this-&gt;<span class="keyword">set</span>($key,$value);
<a name="l00662"></a>00662             }
<a name="l00663"></a>00663             <span class="keywordflow">return</span> $this;
<a name="l00664"></a>00664         }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666         <span class="keywordflow">if</span>($value===undefined)<span class="keywordflow">throw</span> $this-&gt;exception(<span class="stringliteral">&#39;Specify value when calling set()&#39;</span>);
<a name="l00667"></a>00667 
<a name="l00668"></a>00668         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;set&#39;</span>][$field]=$value;
<a name="l00669"></a>00669         <span class="keywordflow">return</span> $this;
<a name="l00670"></a>00670     }
<a name="l00671"></a>00671     <span class="keyword">function</span> render_set(){
<a name="l00672"></a>00672         $x=array();
<a name="l00673"></a>00673         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;set&#39;</span>])<span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;set&#39;</span>] as $field=&gt;$value){
<a name="l00674"></a>00674 
<a name="l00675"></a>00675             <span class="keywordflow">if</span>(is_object($field))$field=$this-&gt;<a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($field);<span class="keywordflow">else</span>$field=$this-&gt;bt($field);
<a name="l00676"></a>00676             <span class="keywordflow">if</span>(is_object($value))$value=$this-&gt;<a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($value);<span class="keywordflow">else</span>$value=$this-&gt;<a class="code" href="class_d_b__dsql.html#a779e0391b11124388a4f850714c3c837">escape</a>($value);
<a name="l00677"></a>00677 
<a name="l00678"></a>00678             $x[]=$field.<span class="charliteral">&#39;=&#39;</span>.$value;
<a name="l00679"></a>00679         }
<a name="l00680"></a>00680         <span class="keywordflow">return</span> <a class="code" href="class_d_b__dsql.html#a0b2af216ca7dad64faa8d9ec06e69a06">join</a>(<span class="stringliteral">&#39;, &#39;</span>,$x);
<a name="l00681"></a>00681     }
<a name="l00682"></a>00682     <span class="keyword">function</span> render_set_fields(){
<a name="l00683"></a>00683         $x=array();
<a name="l00684"></a>00684         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;set&#39;</span>])<span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;set&#39;</span>] as $field=&gt;$value){
<a name="l00685"></a>00685 
<a name="l00686"></a>00686             <span class="keywordflow">if</span>(is_object($field))$field=$this-&gt;<a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($field);<span class="keywordflow">else</span>$field=$this-&gt;bt($field);
<a name="l00687"></a>00687 
<a name="l00688"></a>00688             $x[]=$field;
<a name="l00689"></a>00689         }
<a name="l00690"></a>00690         <span class="keywordflow">return</span> <a class="code" href="class_d_b__dsql.html#a0b2af216ca7dad64faa8d9ec06e69a06">join</a>(<span class="charliteral">&#39;,&#39;</span>,$x);
<a name="l00691"></a>00691     }
<a name="l00692"></a>00692     <span class="keyword">function</span> render_set_values(){
<a name="l00693"></a>00693         $x=array();
<a name="l00694"></a>00694         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;set&#39;</span>])<span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;set&#39;</span>] as $field=&gt;$value){
<a name="l00695"></a>00695 
<a name="l00696"></a>00696             <span class="keywordflow">if</span>(is_object($value))$value=$this-&gt;<a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($value);<span class="keywordflow">else</span>$value=$this-&gt;<a class="code" href="class_d_b__dsql.html#a779e0391b11124388a4f850714c3c837">escape</a>($value);
<a name="l00697"></a>00697 
<a name="l00698"></a>00698             $x[]=$value;
<a name="l00699"></a>00699         }
<a name="l00700"></a>00700         <span class="keywordflow">return</span> <a class="code" href="class_d_b__dsql.html#a0b2af216ca7dad64faa8d9ec06e69a06">join</a>(<span class="charliteral">&#39;,&#39;</span>,$x);
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702     <span class="comment">// }}}</span>
<a name="l00703"></a>00703     <span class="comment">// {{{ MISC</span>
<a name="l00705"></a><a class="code" href="class_d_b__dsql.html#a0ade8c219b8908393de79f366bb4dc4b">00705</a> <span class="comment"></span>    <span class="keyword">public</span> <a class="code" href="class_d_b__dsql.html#a0ade8c219b8908393de79f366bb4dc4b">$bt</a>=<span class="charliteral">&#39;`&#39;</span>;
<a name="l00706"></a>00706     <span class="keyword">function</span> bt($s){
<a name="l00707"></a>00707         <span class="keywordflow">if</span>(is_array($s)){
<a name="l00708"></a>00708             $out=array();
<a name="l00709"></a>00709             <span class="keywordflow">foreach</span>($s as $ss){
<a name="l00710"></a>00710                 $out[]=$this-&gt;bt($ss);
<a name="l00711"></a>00711             }
<a name="l00712"></a>00712             <span class="keywordflow">return</span> $out;
<a name="l00713"></a>00713         }
<a name="l00714"></a>00714 
<a name="l00715"></a>00715         <span class="keywordflow">if</span>(!$this-&gt;bt
<a name="l00716"></a>00716         || is_object($s)
<a name="l00717"></a>00717         || $s==<span class="charliteral">&#39;*&#39;</span>
<a name="l00718"></a>00718         || strpos($s,<span class="charliteral">&#39;.&#39;</span>)!==<span class="keyword">false</span>
<a name="l00719"></a>00719         || strpos($s,<span class="charliteral">&#39;(&#39;</span>)!==<span class="keyword">false</span>
<a name="l00720"></a>00720         || strpos($s,$this-&gt;bt)!==<span class="keyword">false</span>
<a name="l00721"></a>00721         )<span class="keywordflow">return</span> $s;
<a name="l00722"></a>00722 
<a name="l00723"></a>00723         <span class="keywordflow">return</span> $this-&gt;bt.$s.$this-&gt;bt;
<a name="l00724"></a>00724     }
<a name="l00725"></a>00725     <span class="comment">/* Defines query option */</span>
<a name="l00726"></a>00726     <span class="keyword">function</span> _setArray($values,<a class="code" href="class_abstract_object.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>,$parse_commas=<span class="keyword">true</span>){
<a name="l00727"></a>00727         <span class="keywordflow">if</span>(is_string($values) &amp;&amp; $parse_commas &amp;&amp; strpos($values,<span class="charliteral">&#39;,&#39;</span>))$values=explode(<span class="charliteral">&#39;,&#39;</span>,$values);
<a name="l00728"></a>00728         <span class="keywordflow">if</span>(!is_array($values))$values=array($values);
<a name="l00729"></a>00729         <span class="keywordflow">if</span>(!isset($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<a class="code" href="class_abstract_object.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>]))$this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<a class="code" href="class_abstract_object.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>]=array();
<a name="l00730"></a>00730         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<a class="code" href="class_abstract_object.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>]=array_merge($this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[$name],$values);
<a name="l00731"></a>00731         <span class="keywordflow">return</span> $this;
<a name="l00732"></a>00732     }
<a name="l00733"></a>00733     <span class="comment">// }}}</span>
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     <span class="comment">// }}}</span>
<a name="l00736"></a>00736 
<a name="l00737"></a>00737     <span class="comment">// {{{ Statement templates and interfaces</span>
<a name="l00738"></a>00738 
<a name="l00740"></a><a class="code" href="class_d_b__dsql.html#aafe6b4c8e08d1fce2b69f3b9959b2d33">00740</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#aafe6b4c8e08d1fce2b69f3b9959b2d33">SQLTemplate</a>(<a class="code" href="class_d_b__dsql.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>){
<a name="l00741"></a>00741         $this-&gt;mode=<a class="code" href="class_d_b__dsql.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>;
<a name="l00742"></a>00742         $this-&gt;<span class="keyword">template</span>=$this-&gt;sql_templates[<a class="code" href="class_d_b__dsql.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>];
<a name="l00743"></a>00743         <span class="keywordflow">return</span> $this;
<a name="l00744"></a>00744     }
<a name="l00746"></a><a class="code" href="class_d_b__dsql.html#a6731fe1c6830fb506fb642f2d44064e6">00746</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a6731fe1c6830fb506fb642f2d44064e6">call</a>($fx,<a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">$args</a>=null){
<a name="l00747"></a>00747         $this-&gt;mode=<span class="stringliteral">&#39;call&#39;</span>;
<a name="l00748"></a>00748         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;fx&#39;</span>]=$fx;
<a name="l00749"></a>00749         <span class="keywordflow">if</span>(!is_null(<a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">$args</a>)){
<a name="l00750"></a>00750             $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>(<a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">$args</a>);
<a name="l00751"></a>00751         }
<a name="l00752"></a>00752         $this-&gt;<span class="keyword">template</span>=<span class="stringliteral">&quot;call [fx]([args])&quot;</span>;
<a name="l00753"></a>00753         <span class="keywordflow">return</span> $this;
<a name="l00754"></a>00754     }
<a name="l00755"></a>00755     <span class="keyword">function</span> fx($fx,<a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">$args</a>=null){
<a name="l00756"></a>00756         $this-&gt;mode=<span class="stringliteral">&#39;fx&#39;</span>;
<a name="l00757"></a>00757         $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;fx&#39;</span>]=$fx;
<a name="l00758"></a>00758         <span class="keywordflow">if</span>(!is_null(<a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">$args</a>)){
<a name="l00759"></a>00759             $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>(<a class="code" href="class_d_b__dsql.html#a67e94494731d99ed23b123e95175bc10">$args</a>);
<a name="l00760"></a>00760         }
<a name="l00761"></a>00761         $this-&gt;<span class="keyword">template</span>=<span class="stringliteral">&quot;[fx]([args])&quot;</span>;
<a name="l00762"></a>00762         <span class="keywordflow">return</span> $this;
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764     <span class="keyword">function</span> render_fx(){
<a name="l00765"></a>00765         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[<span class="stringliteral">&#39;fx&#39;</span>];
<a name="l00766"></a>00766     }
<a name="l00767"></a>00767     <span class="keyword">function</span> sum($arg=null){
<a name="l00768"></a>00768         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a0fd03e124cf2e910eac90a201bdedd01">expr</a>(<span class="stringliteral">&#39;sum([sum])&#39;</span>)-&gt;setCustom(<span class="stringliteral">&#39;sum&#39;</span>,$this-&gt;bt($arg));
<a name="l00769"></a>00769     }
<a name="l00770"></a>00770     <span class="keyword">function</span> count($arg=null){
<a name="l00771"></a>00771         <span class="keywordflow">if</span>(is_null($arg))$arg=<span class="charliteral">&#39;*&#39;</span>;
<a name="l00772"></a>00772         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a0fd03e124cf2e910eac90a201bdedd01">expr</a>(<span class="stringliteral">&#39;count([count])&#39;</span>)-&gt;setCustom(<span class="stringliteral">&#39;count&#39;</span>,$this-&gt;bt($arg));
<a name="l00773"></a>00773     }
<a name="l00774"></a>00774     <span class="comment">// }}}</span>
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="comment">// {{{ More complex query generations and specific cases</span>
<a name="l00777"></a>00777 
<a name="l00779"></a><a class="code" href="class_d_b__dsql.html#a1909f4b7f8129c7790cb75de2ffbe1e4">00779</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a1909f4b7f8129c7790cb75de2ffbe1e4">execute</a>(){
<a name="l00780"></a>00780         <span class="keywordflow">try</span> {
<a name="l00781"></a>00781             $this-&gt;api-&gt;pr-&gt;start(<span class="stringliteral">&#39;dsql/execute/render&#39;</span>);
<a name="l00782"></a>00782             $q=$this-&gt;<a class="code" href="class_d_b__dsql.html#afde88292c44dc59faf017738dae6dffb">render</a>();
<a name="l00783"></a>00783             $this-&gt;api-&gt;pr-&gt;next(<span class="stringliteral">&#39;dsql/execute/query&#39;</span>);
<a name="l00784"></a>00784             $this-&gt;stmt=$this-&gt;owner-&gt;query($q,$this-&gt;params);
<a name="l00785"></a>00785             $this-&gt;<span class="keyword">template</span>=$this-&gt;mode=null;
<a name="l00786"></a>00786             $this-&gt;api-&gt;pr-&gt;stop();
<a name="l00787"></a>00787             <span class="keywordflow">return</span> $this;
<a name="l00788"></a>00788         }<span class="keywordflow">catch</span>(PDOException $e){
<a name="l00789"></a>00789             <span class="keywordflow">throw</span> $this-&gt;exception(<span class="stringliteral">&#39;Database Query Failed&#39;</span>)
<a name="l00790"></a>00790                 -&gt;addPDOException($e)
<a name="l00791"></a>00791                 -&gt;addMoreInfo(<span class="stringliteral">&#39;mode&#39;</span>,$this-&gt;mode)
<a name="l00792"></a>00792                 -&gt;addMoreInfo(<span class="stringliteral">&#39;params&#39;</span>,$this-&gt;params)
<a name="l00793"></a>00793                 -&gt;addMoreInfo(<span class="stringliteral">&#39;query&#39;</span>,$q)
<a name="l00794"></a>00794                 -&gt;addMoreInfo(<span class="stringliteral">&#39;template&#39;</span>,$this-&gt;<span class="keyword">template</span>)
<a name="l00795"></a>00795                 ;
<a name="l00796"></a>00796         }
<a name="l00797"></a>00797     }
<a name="l00799"></a><a class="code" href="class_d_b__dsql.html#a701f78ac6d7ece9e18883fe7ee612e9f">00799</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a701f78ac6d7ece9e18883fe7ee612e9f">select</a>(){
<a name="l00800"></a>00800         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#aafe6b4c8e08d1fce2b69f3b9959b2d33">SQLTemplate</a>(<span class="stringliteral">&#39;select&#39;</span>)-&gt;execute();
<a name="l00801"></a>00801     }
<a name="l00803"></a><a class="code" href="class_d_b__dsql.html#a473241246338cfccc4709ba896749019">00803</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a473241246338cfccc4709ba896749019">insert</a>(){
<a name="l00804"></a>00804         $this-&gt;<a class="code" href="class_d_b__dsql.html#aafe6b4c8e08d1fce2b69f3b9959b2d33">SQLTemplate</a>(<span class="stringliteral">&#39;insert&#39;</span>)-&gt;execute();
<a name="l00805"></a>00805         <span class="keywordflow">return</span> 
<a name="l00806"></a>00806             $this-&gt;hasInsertOption(<span class="stringliteral">&#39;ignore&#39;</span>)?null:
<a name="l00807"></a>00807             $this-&gt;owner-&gt;lastID();
<a name="l00808"></a>00808     }
<a name="l00810"></a><a class="code" href="class_d_b__dsql.html#ad9477b27ed5cb5ab0d33881cf90bb539">00810</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#ad9477b27ed5cb5ab0d33881cf90bb539">insertAll</a>($array){
<a name="l00811"></a>00811         $ids=array();
<a name="l00812"></a>00812         <span class="keywordflow">foreach</span>($array as $hash){
<a name="l00813"></a>00813             $ids[]=$this-&gt;<a class="code" href="class_d_b__dsql.html#ad07e8760e1263533acbfe0eb8cb4e6a5">del</a>(<span class="stringliteral">&#39;set&#39;</span>)-&gt;set($hash)-&gt;insert();
<a name="l00814"></a>00814         }
<a name="l00815"></a>00815         <span class="keywordflow">return</span> $ids;
<a name="l00816"></a>00816     }
<a name="l00818"></a><a class="code" href="class_d_b__dsql.html#a842e4774e3b3601a005b995c02f7e883">00818</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a842e4774e3b3601a005b995c02f7e883">update</a>(){
<a name="l00819"></a>00819         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#aafe6b4c8e08d1fce2b69f3b9959b2d33">SQLTemplate</a>(<span class="stringliteral">&#39;update&#39;</span>)-&gt;execute();
<a name="l00820"></a>00820     }
<a name="l00822"></a><a class="code" href="class_d_b__dsql.html#a3c55ebd02c35b195034c3a5c8caa8fa3">00822</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a3c55ebd02c35b195034c3a5c8caa8fa3">replace</a>(){
<a name="l00823"></a>00823         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#aafe6b4c8e08d1fce2b69f3b9959b2d33">SQLTemplate</a>(<span class="stringliteral">&#39;replace&#39;</span>)-&gt;execute();
<a name="l00824"></a>00824     }
<a name="l00826"></a><a class="code" href="class_d_b__dsql.html#a13bdffdd926f26b825ea57066334ff01">00826</a>     <span class="keyword">function</span> <span class="keyword">delete</span>(){
<a name="l00827"></a>00827         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#aafe6b4c8e08d1fce2b69f3b9959b2d33">SQLTemplate</a>(<span class="stringliteral">&#39;delete&#39;</span>)-&gt;execute();
<a name="l00828"></a>00828     }
<a name="l00830"></a><a class="code" href="class_d_b__dsql.html#aded92815b0f4cd9a64f76a6019162198">00830</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#aded92815b0f4cd9a64f76a6019162198">truncate</a>(){
<a name="l00831"></a>00831         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#aafe6b4c8e08d1fce2b69f3b9959b2d33">SQLTemplate</a>(<span class="stringliteral">&#39;truncate&#39;</span>)-&gt;execute();
<a name="l00832"></a>00832     }
<a name="l00833"></a>00833 
<a name="l00835"></a><a class="code" href="class_d_b__dsql.html#abc5dee7a1bfdcfe56e49e4265feb5b9c">00835</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#abc5dee7a1bfdcfe56e49e4265feb5b9c">do_select</a>(){
<a name="l00836"></a>00836         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a701f78ac6d7ece9e18883fe7ee612e9f">select</a>();
<a name="l00837"></a>00837     }
<a name="l00839"></a><a class="code" href="class_d_b__dsql.html#ab3aea362579fa1436c4f09c54832763f">00839</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#ab3aea362579fa1436c4f09c54832763f">do_insert</a>(){
<a name="l00840"></a>00840         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a473241246338cfccc4709ba896749019">insert</a>();
<a name="l00841"></a>00841     }
<a name="l00843"></a><a class="code" href="class_d_b__dsql.html#a43ab835782c53b0252bfb98cf64e4194">00843</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a43ab835782c53b0252bfb98cf64e4194">do_update</a>(){
<a name="l00844"></a>00844         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a842e4774e3b3601a005b995c02f7e883">update</a>();
<a name="l00845"></a>00845     }
<a name="l00847"></a><a class="code" href="class_d_b__dsql.html#a533a86de08868e30fba45014ec22833d">00847</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a533a86de08868e30fba45014ec22833d">do_replace</a>(){
<a name="l00848"></a>00848         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a3c55ebd02c35b195034c3a5c8caa8fa3">replace</a>();
<a name="l00849"></a>00849     }
<a name="l00850"></a>00850     <span class="comment">// }}}</span>
<a name="l00851"></a>00851 
<a name="l00852"></a>00852     <span class="comment">// {{{ Data fetching modes</span>
<a name="l00854"></a><a class="code" href="class_d_b__dsql.html#ac33ee765f5ad9f134540bac393721cfe">00854</a> <span class="comment"></span>    <span class="keyword">function</span> <span class="keyword">get</span>(){
<a name="l00855"></a>00855         <span class="keywordflow">if</span>(!$this-&gt;stmt)$this-&gt;<a class="code" href="class_d_b__dsql.html#a1909f4b7f8129c7790cb75de2ffbe1e4">execute</a>();
<a name="l00856"></a>00856         $res=$this-&gt;stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
<a name="l00857"></a>00857         $this-&gt;rewind();
<a name="l00858"></a>00858         $this-&gt;stmt=null;
<a name="l00859"></a>00859         <span class="keywordflow">return</span> $res;
<a name="l00860"></a>00860     }
<a name="l00862"></a><a class="code" href="class_d_b__dsql.html#acdee9d2d2dd63b3399c1c561e9908796">00862</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#acdee9d2d2dd63b3399c1c561e9908796">getOne</a>(){
<a name="l00863"></a>00863         $res=$this-&gt;<a class="code" href="class_d_b__dsql.html#a632382a60ab0034764c10ee608fb39da">getRow</a>();
<a name="l00864"></a>00864         $this-&gt;rewind();
<a name="l00865"></a>00865         $this-&gt;stmt=null;
<a name="l00866"></a>00866         <span class="keywordflow">return</span> $res[0];
<a name="l00867"></a>00867     }
<a name="l00869"></a><a class="code" href="class_d_b__dsql.html#a632382a60ab0034764c10ee608fb39da">00869</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a632382a60ab0034764c10ee608fb39da">getRow</a>(){ 
<a name="l00870"></a>00870         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a960c7ace068b0a84931cc56cbd804229">fetch</a>(PDO::FETCH_NUM);
<a name="l00871"></a>00871     }
<a name="l00873"></a><a class="code" href="class_d_b__dsql.html#a10220afb27800deb78f48b4698a74742">00873</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a10220afb27800deb78f48b4698a74742">getHash</a>(){ 
<a name="l00874"></a>00874         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a960c7ace068b0a84931cc56cbd804229">fetch</a>(PDO::FETCH_ASSOC);
<a name="l00875"></a>00875     }
<a name="l00877"></a><a class="code" href="class_d_b__dsql.html#a960c7ace068b0a84931cc56cbd804229">00877</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a960c7ace068b0a84931cc56cbd804229">fetch</a>(<a class="code" href="class_d_b__dsql.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>=PDO::FETCH_ASSOC){
<a name="l00878"></a>00878         <span class="keywordflow">if</span>(!$this-&gt;stmt)$this-&gt;<a class="code" href="class_d_b__dsql.html#a1909f4b7f8129c7790cb75de2ffbe1e4">execute</a>();
<a name="l00879"></a>00879         <span class="keywordflow">return</span> $this-&gt;stmt-&gt;fetch(<a class="code" href="class_d_b__dsql.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>);
<a name="l00880"></a>00880     }
<a name="l00881"></a>00881     <span class="comment">// {{{ Obsolete functions </span>
<a name="l00883"></a><a class="code" href="class_d_b__dsql.html#af008f367d5ca054454dacc1e8830d7fd">00883</a> <span class="comment"></span>    <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#af008f367d5ca054454dacc1e8830d7fd">fetchAll</a>(){
<a name="l00884"></a>00884         <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>();
<a name="l00885"></a>00885     }
<a name="l00887"></a><a class="code" href="class_d_b__dsql.html#aa8c81447628f1110490dfdf4639d7d2f">00887</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#aa8c81447628f1110490dfdf4639d7d2f">do_getOne</a>(){
<a name="l00888"></a>00888         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#acdee9d2d2dd63b3399c1c561e9908796">getOne</a>(); 
<a name="l00889"></a>00889     }
<a name="l00891"></a><a class="code" href="class_d_b__dsql.html#a5e4d5b11e0ce94a2bfae6913972eacf1">00891</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a5e4d5b11e0ce94a2bfae6913972eacf1">do_getAllHash</a>(){ 
<a name="l00892"></a>00892         <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>(); 
<a name="l00893"></a>00893     }
<a name="l00894"></a>00894     <span class="keyword">function</span> do_getAll(){ 
<a name="l00895"></a>00895         <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>(); 
<a name="l00896"></a>00896     }
<a name="l00898"></a><a class="code" href="class_d_b__dsql.html#aba0d5b303383fb5b1fabb5fd01cd3800">00898</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#aba0d5b303383fb5b1fabb5fd01cd3800">getAll</a>(){
<a name="l00899"></a>00899         <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>();
<a name="l00900"></a>00900     }
<a name="l00902"></a><a class="code" href="class_d_b__dsql.html#a18d0b369779c5f828c7c5da89ff11bad">00902</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a18d0b369779c5f828c7c5da89ff11bad">do_getRow</a>(){ 
<a name="l00903"></a>00903         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a632382a60ab0034764c10ee608fb39da">getRow</a>();
<a name="l00904"></a>00904     }
<a name="l00906"></a><a class="code" href="class_d_b__dsql.html#a8286947e1f3dc71c4b04f03269860f5a">00906</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a8286947e1f3dc71c4b04f03269860f5a">do_getHash</a>(){ 
<a name="l00907"></a>00907         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_d_b__dsql.html#a10220afb27800deb78f48b4698a74742">getHash</a>(); 
<a name="l00908"></a>00908     }
<a name="l00909"></a>00909     <span class="comment">// }}}</span>
<a name="l00910"></a>00910 
<a name="l00911"></a>00911 
<a name="l00913"></a><a class="code" href="class_d_b__dsql.html#a48101134c570bf8cbcb59cf290815194">00913</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a48101134c570bf8cbcb59cf290815194">calc_found_rows</a>(){
<a name="l00914"></a>00914         <span class="comment">// add option for row calculation if supported</span>
<a name="l00915"></a>00915         <span class="keywordflow">return</span> $this;
<a name="l00916"></a>00916     }
<a name="l00918"></a><a class="code" href="class_d_b__dsql.html#a78250827a715cdf14ebf6d3b6029118f">00918</a>     <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#a78250827a715cdf14ebf6d3b6029118f">foundRows</a>(){
<a name="l00919"></a>00919         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#a11ad07d9420b0b9db29da1e39a596e98">hasOption</a>(<span class="stringliteral">&#39;SQL_CALC_FOUND_ROWS&#39;</span>)){
<a name="l00920"></a>00920             <span class="keywordflow">return</span> $this-&gt;owner-&gt;getOne(<span class="stringliteral">&#39;select found_rows()&#39;</span>);
<a name="l00921"></a>00921         }
<a name="l00922"></a>00922         <span class="comment">/* db-compatibl way: */</span>
<a name="l00923"></a>00923         $c=clone $this;
<a name="l00924"></a>00924         $c-&gt;del(<span class="stringliteral">&#39;limit&#39;</span>);
<a name="l00925"></a>00925         $c-&gt;del(<span class="stringliteral">&#39;fields&#39;</span>);
<a name="l00926"></a>00926         $c-&gt;field(<span class="stringliteral">&#39;count(*)&#39;</span>);
<a name="l00927"></a>00927         <span class="keywordflow">return</span> $c-&gt;getOne();
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929     <span class="comment">// }}}</span>
<a name="l00930"></a>00930 
<a name="l00931"></a>00931     <span class="comment">// {{{ Iterator support </span>
<a name="l00932"></a>00932     <span class="keyword">public</span> $data=<span class="keyword">false</span>;
<a name="l00933"></a>00933     <span class="keyword">public</span> $_iterating=<span class="keyword">false</span>;
<a name="l00934"></a>00934     <span class="keyword">function</span> rewind(){
<a name="l00935"></a>00935         <span class="keywordflow">if</span>($this-&gt;_iterating){
<a name="l00936"></a>00936             $this-&gt;stmt=null;
<a name="l00937"></a>00937             $this-&gt;_iterating=<span class="keyword">false</span>;
<a name="l00938"></a>00938         }
<a name="l00939"></a>00939         $this-&gt;_iterating=<span class="keyword">true</span>;
<a name="l00940"></a>00940         <span class="keywordflow">return</span> $this;
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942     <span class="keyword">function</span> next(){
<a name="l00943"></a>00943         $this-&gt;data = $this-&gt;<a class="code" href="class_d_b__dsql.html#a960c7ace068b0a84931cc56cbd804229">fetch</a>();
<a name="l00944"></a>00944         <span class="keywordflow">return</span> $this;
<a name="l00945"></a>00945     }
<a name="l00946"></a>00946     <span class="keyword">function</span> current(){
<a name="l00947"></a>00947         <span class="keywordflow">return</span> $this-&gt;data;
<a name="l00948"></a>00948     }
<a name="l00949"></a>00949     <span class="keyword">function</span> key(){
<a name="l00950"></a>00950         <span class="keywordflow">return</span> $this-&gt;data[<span class="stringliteral">&#39;id&#39;</span>];
<a name="l00951"></a>00951     }
<a name="l00952"></a>00952     <span class="keyword">function</span> valid(){
<a name="l00953"></a>00953         <span class="keywordflow">if</span>(!$this-&gt;stmt)$this-&gt;data = $this-&gt;<a class="code" href="class_d_b__dsql.html#a960c7ace068b0a84931cc56cbd804229">fetch</a>();
<a name="l00954"></a>00954         <span class="keywordflow">return</span> (<span class="keywordtype">boolean</span>)$this-&gt;data;
<a name="l00955"></a>00955     }
<a name="l00956"></a>00956     <span class="comment">// }}}</span>
<a name="l00957"></a>00957 
<a name="l00958"></a>00958     <span class="comment">// {{{ Rendering</span>
<a name="l00960"></a><a class="code" href="class_d_b__dsql.html#aaed74f7942d3fc56582e99324500e87b">00960</a> <span class="comment"></span>    <span class="keyword">function</span> <a class="code" href="class_d_b__dsql.html#aaed74f7942d3fc56582e99324500e87b">debug</a>(){
<a name="l00961"></a>00961         $this-&gt;<a class="code" href="class_d_b__dsql.html#aaed74f7942d3fc56582e99324500e87b">debug</a>=1;
<a name="l00962"></a>00962         <span class="keywordflow">return</span> $this;
<a name="l00963"></a>00963     }
<a name="l00964"></a>00964     <span class="keyword">function</span> getDebugQuery($r=null){
<a name="l00965"></a>00965         <span class="keywordflow">if</span>(!$r)$r=$this-&gt;_render();
<a name="l00966"></a>00966         $d=$r;
<a name="l00967"></a>00967         $pp=array();
<a name="l00968"></a>00968         $d=preg_replace(<span class="stringliteral">&#39;/`([^`]*)`/&#39;</span>,<span class="stringliteral">&#39;`&lt;font color=&quot;black&quot;&gt;\1&lt;/font&gt;`&#39;</span>,$d);
<a name="l00969"></a>00969         <span class="keywordflow">foreach</span>(array_reverse($this-&gt;params) as $key=&gt;$val){
<a name="l00970"></a>00970             <span class="keywordflow">if</span>(is_string($val))$d=preg_replace(<span class="charliteral">&#39;/&#39;</span>.$key.<span class="stringliteral">&#39;([^_]|$)/&#39;</span>,<span class="stringliteral">&#39;&quot;&lt;font color=&quot;green&quot;&gt;&#39;</span>.htmlspecialchars(addslashes($val)).<span class="stringliteral">&#39;&lt;/font&gt;&quot;\1&#39;</span>,$d);
<a name="l00971"></a>00971             elseif(is_null($val))$d=preg_replace(&#39;/&#39;.$key.&#39;([^_]|$)/&#39;,&#39;&lt;font color=&quot;black&quot;&gt;NULL&lt;/font&gt;\1&#39;,$d);
<a name="l00972"></a>00972             elseif(is_numeric($val))$d=preg_replace(&#39;/&#39;.$key.&#39;([^_]|$)/&#39;,&#39;&lt;font color=&quot;red&quot;&gt;&#39;.$val.&#39;&lt;/font&gt;\1&#39;,$d);
<a name="l00973"></a>00973             else$d=preg_replace(&#39;/&#39;.$key.&#39;([^_]|$)/&#39;,$val.&#39;\1&#39;,$d);
<a name="l00974"></a>00974 
<a name="l00975"></a>00975             $pp[]=$key;
<a name="l00976"></a>00976         }
<a name="l00977"></a>00977         return &quot;&lt;font color=&#39;blue&#39;&gt;&quot;.$d.&quot;&lt;/font&gt; &lt;font color=&#39;gray&#39;&gt;[&quot;.<a class="code" href="class_d_b__dsql.html#a0b2af216ca7dad64faa8d9ec06e69a06">join</a>(&#39;, &#39;,$pp).&quot;]&lt;/font&gt;&lt;br/&gt;&quot;;
<a name="l00978"></a>00978     }
<a name="l00980"></a><a class="code" href="class_d_b__dsql.html#afde88292c44dc59faf017738dae6dffb">00980</a>     function <a class="code" href="class_d_b__dsql.html#afde88292c44dc59faf017738dae6dffb">render</a>(){
<a name="l00981"></a>00981         $this-&gt;params=$this-&gt;extra_params;
<a name="l00982"></a>00982         $r=$this-&gt;_render();
<a name="l00983"></a>00983         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_d_b__dsql.html#aaed74f7942d3fc56582e99324500e87b">debug</a>){
<a name="l00984"></a>00984             echo $this-&gt;getDebugQuery($r);
<a name="l00985"></a>00985         }
<a name="l00986"></a>00986         <span class="keywordflow">return</span> $r;
<a name="l00987"></a>00987     }
<a name="l00988"></a>00988     <span class="keyword">function</span> _render(){
<a name="l00989"></a>00989         $this-&gt;api-&gt;pr-&gt;start(<span class="stringliteral">&#39;dsql/render&#39;</span>);
<a name="l00990"></a>00990         <span class="keywordflow">if</span>(!$this-&gt;<span class="keyword">template</span>)$this-&gt;<a class="code" href="class_d_b__dsql.html#aafe6b4c8e08d1fce2b69f3b9959b2d33">SQLTemplate</a>(<span class="stringliteral">&#39;select&#39;</span>);
<a name="l00991"></a>00991         $self=$this;
<a name="l00992"></a>00992         $res= preg_replace_callback(<span class="stringliteral">&#39;/\[([a-z0-9_]*)\]/&#39;</span>,<span class="keyword">function</span>($matches) use($self){
<a name="l00993"></a>00993             $self-&gt;api-&gt;pr-&gt;next(<span class="stringliteral">&#39;dsql/render/&#39;</span>.$matches[1],<span class="keyword">true</span>);
<a name="l00994"></a>00994             $fx=<span class="stringliteral">&#39;render_&#39;</span>.$matches[1];
<a name="l00995"></a>00995             <span class="keywordflow">if</span>($self-&gt;hasMethod($fx))<span class="keywordflow">return</span> $self-&gt;$fx();
<a name="l00996"></a>00996             elseif(isset($self-&gt;args[<span class="stringliteral">&#39;custom&#39;</span>][$matches[1]]))return $self-&gt;<a class="code" href="class_d_b__dsql.html#a276d52ca56cc158619aa2c44a9216861">consume</a>($self-&gt;<a class="code" href="class_d_b__dsql.html#a065dd3167e68f7110493238c8da7218a">args</a>[&#39;custom&#39;][$matches[1]]);
<a name="l00997"></a>00997             else return $matches[0];
<a name="l00998"></a>00998         },$this-&gt;<a class="code" href="class_d_b__dsql.html#a2e98fa0bf8a8263c1f551bdb3a4b65d5">template</a>);
<a name="l00999"></a>00999         $this-&gt;api-&gt;pr-&gt;stop(null,true);
<a name="l01000"></a>01000         return $res;
<a name="l01001"></a>01001     }
<a name="l01002"></a>01002     <span class="comment">// }}}</span>
<a name="l01003"></a>01003 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>dsql.php</b>      </li>

    <li class="footer">Generated on Thu Aug 23 2012 12:28:40 for Agile Toolkit by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
