
<?$Content?>

<div class="g-row" id="doc-ref">
	<div class="g-12">
        <h1>Pages, Objects and Links</h1>
        <p>Web is greatly inspired by books. Similarly to book, the most fundamental part of the web is "a page". Page is
        collection of related objects and links. Links would usually lead to other pages, while objects may dynamically
        interact with user while he remains on the same page.</p>

        <p>Agile Toolkit relies on the similar concepts. Ultimately your project will consist of pages and each page would
        consist of static information, links and objects. Let's look closely how Pages are implemented in Agile Toolkit:</p>

        <h2>Page Implementation in Agile Toolkit</h2>
        <p>In Agile Toolkit, pages are handled by a special objects instantiated from Page class. Any page has a name to
        which it will respond. Usually one page object is automatically initialized by the API along with all the objects
        on that page.</p>

        <p>You might have noticed, how we were adding objects in the previous chapter into $page. This variable refers to a
        current page object. In reality, you most probably would be putting the code directly into page/index.php which
        defines class page_index and any objects you want to see on this page should be added inside init() method.</p>

        <p>By it's nature Page object is also derived from AbstractView. All you need to do is define page classes. Do not
        manually add page objects,
        API will do it for you. But how does API knows which page class to use?</p>

        <h3>Page Routing</h3>
        <p>By default, Agile Toolkit is using front-controller approach. All the requests are being captured and executed
        in the same way, through mod_rewrite and through index.php which creates and executes API. API relies on a specific
        component called PageManager. The job of PageManager is to determine name of the Page Class from the used URL.</p>

        <p>The actual logic is always quite intuitive. Look at the following page for examples:</p>
<div class="box blue-noised p-10px">
	<div class="white">
		<table>
			<thead>
				<tr>
					<th>Browser URL</th>
					<th>Page</th>
					<th width="50%">Notes</th>
				</tr>
			</thead>
			<tbody>
			<tr>
				<td>http://example.com/preferences.html</td>
				<td>preferences</td>
				<td>Agile Toolkit completely ignores the extension and uses remaining location to determine page name.</td>
			</tr>
			<tr>
				<td>http://example.com/index.php?page=user/add</td>
				<td>user/add</td>
				<td>Your default install of Agile Toolkit is not configured to use mod_rewrite. Therefore URL in browser will
                appear to have index.php in front of it. Passing page=XX will always override page name, which is very useful
                in in building beautiful URLs</td>
			</tr>
			<tr>
				<td>http://example.com/profile/change-password.do</td>
				<td>profile/changepassword</td>
				<td>Dashes cannot be used in a function or class, they are eliminated from the page name automatically. Any
                extension can be used as long as .htaccess directs them into index.php</td>
			</tr>
			<tr>
				<td>http://example.com/?abc=123</td>
				<td>index</td>
				<td>If URL does not contain page, then "index" page name is used.</td>
			</tr>
			<tr>
				<td>http://example.com/admin/logout</td>
				<td>logout</td>
				<td>Most often site administration is implemented as a separate site with it's other entry point. Pages are
                relative to installation point.</td>
			</tr>
			</tbody>
		</table>
	</div>
</div>

        <h3>URL Components</h3>

        <p>PageManager splits URL from your location bar into 3 parts:

        <ol><li>base_url</li>
        <li>base_path</li>
        <li>page</li></ol>
       
        $api->pm->base_url points at the web-server of your
        web application, such as http://yoursite.com:81. Next part is $api->pm->base_path is pointing to the root page of
        your web software. For example, if you un-pack software under webroot/test/app then
        base_path="/test/app/". base_path always starts and ends with slash.</p>

        <p>Final part is called "page" and it's relative location within your web application. The top-most page is called
        "index" page. The page you are looking at right now is called "learn/understand/page" and is calculated from the url:
        <?page?>.<?/?>.</p>

        <p>Page follows standard pattern, and executes init() method after it's initialized. Page may have a custom template,
        but if it does not, default page layout is used to display empty page.</p>

        <h2>Building URLs</h2>
        <p>Since there are quite a few different ways to configure URLs in Agile Toolkit, there is also a way to produce
        links. For example if you are willing to calculate how the URL would look for page 'preferences/user', you should use
        the following construction:
<?Example?>
$url=$page->api
    ->getDestinationURL('preferences/user');

$page->add('P')->set('URL is '.$url);
$page->add('P')->set('Absolute URL is '.
    $url->useAbsoluteURL());
<?/?>

        <p>You might have noticed that $url is actually an object, which can also be used as a string.</p>

        <p>To pass information between pages, a most convenient way is to use arguments. If you wish to complicate things by
        creating arguments such as /book/39/delete you are free to spend some time on building them, however in most cases
        such presentation might not be important. Agile Toolkit provides a convenient way to pass arguments to any page:</p>

<?Example?>
$url=$page->api
    ->getDestinationURL('search',
            array('q'=>'my book'));

$page->add('P')->set('URL is '.$url);
$page->add('P')->set('Absolute URL is '.
    $url->useAbsoluteURL());
<?/?>

        <p>Arguments are always properly escaped / encoded. Setting argument's value to "false" or "null" will exclude it
        from list of arguments.</p>

        <h3>Sticky GET Arguments</h3>
        <p>Sometimes our page would receive an argument which it shouldn't forget. Agile Toolkit allows you to mark some
        arguments as "sticky", which means they will be passed on to all generated URLs automatically.</p>

        <p>In the following example, if "user" GET argument is passed to the page, this argument will be included in all
        subsequently generated URLs. Positioning of stickyGET() call is important. Effect of stickyGET can be undone by
        calling stickiForget, although normally you wouldn't need to do it.</p>

<?Example?>
$page->api->stickyGET('user');

$url=$page->api
    ->getDestinationURL('search',
            array('q'=>'my book'));

$para=$page->add('P')->set('URL is '.$url.
        ' but same URL without user '.
        $url->set('user',false));

$page->api->stickyForget('user');


$page->add('Button')->setLabel('Refresh paragraph')
    ->js('click',
        $para->js()->reload(array('user'=>123)));

<?/?>

        <h3>Relative Pages</h3>
        <p>Another handy feature in Agile Toolkit is ability to generate URLs from relative paths.</p>
<div class="box blue-noised p-10px">
	<div class="white">
		<table>
			<thead>
				<tr>
					<th>Page</th>
					<th>Generated URL</th>
					<th width="50%">Notes</th>
				</tr>
			</thead>
			<tbody>
			<tr>
				<td>/</td>
				<td><?page?>/<?/?></td>
				<td>Using "/" generates URL to index page.</td>
			</tr>
			<tr>
				<td>.</td>
				<td><?page?>.<?/?></td>
				<td>Single dot refers to the current page. You can also pass "null" as 1st argument to getDestinationURL to
                assume current page</td>
			</tr>
			<tr>
				<td>..</td>
				<td><?page?>..<?/?></td>
				<td>Parent page in page hierarchy.</td>
			</tr>
			<tr>
				<td>../object</td>
				<td><?page?>../object<?/?></td>
				<td>Adjacent page is specified as a sub-page of the parent page.</td>
			</tr>
			<tr>
				<td>./test</td>
				<td><?page?>./test<?/?></td>
				<td>Finally you can link to a sub-page of a current page like this.</td>
			</tr>
			</tbody>
		</table>
	</div>
</div>


    <h3>Try your own examples</h3>


<?Example?>
$form=$page->add('Form');
$in=$form->addField('line','page');
$out=$form->addfield('line','relative_url');

$in->js(true)->univ()
    ->autoChange(200)->disableEnter();
$in->js('change',$form->js()->submit());

$form->onSubmit(function($form) use($out){
    return $out->js()->val(
        $form->api->getDestinationURL(
            $form->get('page')));
});

<?/?>
        <p>As you might have noticed, that no extra checks or escaping is performed on page name. You should never display
        link, where user may directly affect the "page". It is, however, perfectly secure to pass user-supplied data through
        arguments.</p>


        <h2>Adding new page</h2>

        <p>Create a new file inside page/ called mypage.php. Inside there, create a class "page_mypage" extending "Page"
        class and defining init() method. Call parent::init() then add some objects using $this->add(); If you can't think of
        any interesting object to add, use LoremIpsum view.</p>

        <p>Agile Toolkit allows to create pages in few different ways - by defining template only, by defining class only, by
        defining both class and template or by defining none and setting up catch-all handler which might be useful if page
        content is coming from database.



    </div>
</div>

<?$Next?>
